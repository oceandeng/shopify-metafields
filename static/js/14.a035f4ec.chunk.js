(this["webpackJsonpshopify-metafields"]=this["webpackJsonpshopify-metafields"]||[]).push([[14],{217:function(e,t,a){"use strict";var i=a(2),n=a(3),s=a(6),l=a(7),c=a(0),r=a.n(c),o=a(170),d=a(424),u=a(9),h=a(5),p=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(e){return Object(i.a)(this,a),t.call(this,e)}return Object(n.a)(a,[{key:"handleGoBack",value:function(){this.props.history.goBack()}},{key:"render",value:function(){var e=this;return Object(h.jsx)(o.a,{icon:d.a,onClick:function(){e.handleGoBack()}})}}]),a}(r.a.Component);t.a=Object(u.f)(p)},273:function(e,t,a){"use strict";var i=a(2),n=a(3),s=a(6),l=a(7),c=a(0),r=a.n(c),o=a(589),d=a(249),u=a(5),h=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(e){var n;Object(i.a)(this,a);var s=(n=t.call(this,e)).props,l=s.modalTitle,c=s.modalText;return n.state={modalOpen:!1,loading:!1,item:{},modalTitle:l,modalText:c},n}return Object(n.a)(a,[{key:"handleModalDelete",value:function(){var e=this,t=this.state.item;this.setState({loading:!0}),this.props.onModalDelete(t,(function(){e.setState({loading:!1,modalOpen:!1})}))}},{key:"handleModalOpen",value:function(e){this.setState({modalOpen:!0,item:e})}},{key:"handleModalClose",value:function(){this.setState({modalOpen:!1})}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalOpen,i=t.modalTitle,n=t.modalText,s=t.loading;return Object(u.jsx)(o.a,{open:a,title:i,primaryAction:{destructive:!0,content:"Delete",loading:s,onAction:function(){e.handleModalDelete()}},secondaryActions:[{content:"Cancel",onAction:function(){e.handleModalClose()}}],onClose:function(){e.handleModalClose()},children:Object(u.jsx)(o.a.Section,{children:Object(u.jsx)(d.a,{children:Object(u.jsx)("p",{children:n})})})})}}]),a}(r.a.Component);t.a=h},613:function(e,t,a){"use strict";a.r(t);var i=a(184),n=a(2),s=a(3),l=a(6),c=a(7),r=a(0),o=a.n(r),d=a(612),u=a(608),h=a(593),p=a(428),v=a(591),m=a(211),j=a(182),f=a(175),b=a(170),g=a(602),O=a(217),x=a(5),y=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).topBarTitle=window.publicTools.getQuery("topBarTitle"),i.previewUrl=window.publicTools.getQuery("previewUrl"),i.max=10,i.ownerResource=i.props.ownerResource,i.isShowPreview=["variants","customers","orders","draft_orders","shop"].includes(i.ownerResource),i.state={active:!1,isShowPreview:!i.isShowPreview},i}return Object(s.a)(a,[{key:"handleCreate",value:function(){this.props.metafieldsLength>=this.max?this.setState({active:!0}):this.props.handleCreate()}},{key:"toggleActive",value:function(){this.setState({active:!this.state.active})}},{key:"handleView",value:function(){window.open("".concat(window.location.protocol,"//").concat(window.__SHOP__.myshopify_domain,"/").concat(this.previewUrl))}},{key:"render",value:function(){var e=this,t=this.state,a=t.active,i=t.isShowPreview,n=this.props.metafieldsLength;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)(v.a,{children:[Object(x.jsx)(v.a.Section,{children:Object(x.jsxs)("div",{className:"sub-tit-body",children:[Object(x.jsx)("div",{className:"go-back",children:Object(x.jsx)(O.a,{})}),Object(x.jsx)("pre",{children:Object(x.jsx)("div",{className:"sub-heading",children:Object(x.jsx)(m.a,{children:this.topBarTitle?this.topBarTitle:""})})})]})}),Object(x.jsx)(v.a.Section,{secondary:!0,children:Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{fill:!0}),Object(x.jsx)(j.a.Item,{children:Object(x.jsxs)(f.a,{children:[i&&Object(x.jsx)(b.a,{plain:!0,icon:g.a,onClick:function(){e.handleView()},children:"Preview"}),Object(x.jsxs)(b.a,{onClick:function(){e.handleCreate()},children:["Create metafield",Object(x.jsx)("span",{className:"b ml5 g9",children:"(".concat(n,")")})]})]})})]})})]}),a&&Object(x.jsx)(p.a,{content:"Please save your editing first.",onDismiss:function(){return e.toggleActive()}})]})}}]),a}(o.a.Component),D=a(353),S=a(603),k=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={active:!0},i}return Object(s.a)(a,[{key:"toggleActive",value:function(){this.setState({active:!this.state.active}),this.props.onClearInsertRepeats()}},{key:"componentDidUpdate",value:function(e,t){t.active||this.state.active||this.setState({active:!0})}},{key:"render",value:function(){var e=this,t=this.props,a=t.valid,i=t.isRepeat,n=t.insertRepeats,s=t.repeatData;return Object(x.jsxs)("div",{className:"mt20",children:[i&&Object(x.jsx)(D.a,{status:"critical",title:"The current page has duplicate data:",children:s.filter((function(e){return e.data.length>1})).map((function(e,t){return Object(x.jsxs)("div",{children:["Namespace\uff1a",e.namespace," ",Object(x.jsx)("span",{className:"ml20",children:"Key\uff1a"}),e.key]},t)}))}),a&&Object(x.jsx)(D.a,{status:"critical",title:"Error! Ensure you've not missed a field or exceed the character constranints.",icon:S.a}),!!n.length&&this.state.active&&Object(x.jsx)(D.a,{status:"critical",title:"Created duplicate:",icon:S.a,onDismiss:function(){e.toggleActive()},children:n.map((function(e,t){return Object(x.jsxs)("div",{children:["Namespace\uff1a",e.namespace," ",Object(x.jsx)("span",{className:"ml20",children:"Key\uff1a"}),e.key]},t)}))})]})}}]),a}(o.a.Component),I=a(53),w=a(616),C=a(351),N=a(199),M=a(249),T=a(227),_=a(604),V=a(424),F=a(425),R=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={namespace:"",key:""},i}return Object(s.a)(a,[{key:"handleChange",value:function(e,t){this.setState(Object(I.a)({},t,e))}},{key:"handleSearch",value:function(){var e=this.state,t=e.namespace,a=e.key;this.props.onSearch(t,a)}},{key:"handleReset",value:function(){var e=this;this.setState({namespace:"",key:""},(function(){e.handleSearch()}))}},{key:"handlePagination",value:function(e){this.props.onPagination(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.namespace,i=t.key,n=this.props,s=n.metafields,l=n.currentPage,c=n.link;return Object(x.jsxs)("div",{className:this.props.className,children:[Object(x.jsx)(w.a,{sectioned:!0,children:Object(x.jsxs)(v.a,{children:[Object(x.jsx)(v.a.Section,{oneThird:!0,children:Object(x.jsx)(C.a,{value:a,onChange:function(t){e.handleChange(t,"namespace")},placeholder:"namespace"})}),Object(x.jsx)(v.a.Section,{oneThird:!0,children:Object(x.jsx)(C.a,{value:i,onChange:function(t){e.handleChange(t,"key")},placeholder:"key"})}),Object(x.jsx)(v.a.Section,{oneThird:!0,children:Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{fill:!0,children:Object(x.jsxs)(f.a,{children:[Object(x.jsx)(b.a,{icon:_.a,onClick:function(){e.handleSearch()}}),Object(x.jsx)(b.a,{onClick:function(){e.handleReset()},children:"Reset"})]})}),Object(x.jsx)(j.a.Item,{children:Object(x.jsx)("div",{className:"mt5",children:Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{children:Object(x.jsx)(N.a,{variation:"subdued",children:Object(x.jsxs)("div",{className:"lh28",children:["Page ",l]})})}),Object(x.jsxs)(j.a.Item,{children:[Object(x.jsx)(b.a,{size:"large",icon:V.a,disabled:!c.previous,plain:!0,onClick:function(){e.handlePagination("previous")}}),Object(x.jsx)(b.a,{size:"large",icon:F.a,disabled:!c.next,plain:!0,onClick:function(){e.handlePagination("next")}})]})]})})})]})})]})}),!s.length&&(!!a||!!i)&&Object(x.jsx)("div",{className:"tc pt20",children:Object(x.jsxs)(M.a,{children:[Object(x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{width:"80px",height:"80px",fill:"#c3cfd8"},children:Object(x.jsx)("path",{d:"M8 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm9.707 4.293l-4.82-4.82C13.585 10.493 14 9.296 14 8c0-3.313-2.687-6-6-6S2 4.687 2 8s2.687 6 6 6c1.296 0 2.492-.415 3.473-1.113l4.82 4.82c.195.195.45.293.707.293s.512-.098.707-.293c.39-.39.39-1.023 0-1.414z"})}),Object(x.jsx)(T.a,{size:"medium",children:"Could not find any records"}),Object(x.jsx)(N.a,{variation:"subdued",children:"Try changing the search term"})]})})]})}}]),a}(o.a.Component),P=a(11),U=a(430),G=a(290),E=a(605),A=a(429),z=a.n(A),L=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).index=i.props.item.index,i.state={clipSuccess:!1},i}return Object(s.a)(a,[{key:"handleCloseToast",value:function(){this.setState({clipSuccess:!1})}},{key:"handleCalcDate",value:function(e){var t=window.publicTools.clientTimeZone(),a=new Date(e).getTime(),i=60*t.hour*60*1e3+60*t.munite*1e3,n="+"==t.prefix?a+i:a-i;return window.publicTools.getExactTime(n)}},{key:"handleClipboardJS",value:function(){var e=this,t="#copy_".concat(this.index);this.clipboard=new z.a(t),this.clipboard.text=function(t){return"{{".concat(e.props.metafieldsName,".metafields['").concat(e.props.item.namespace,"']['").concat(e.props.item.key,"']}}")},this.clipboard.on("success",(function(t){e.setState({clipSuccess:!0}),t.clearSelection()}))}},{key:"componentDidMount",value:function(){this.handleClipboardJS()}},{key:"componentDidUpdate",value:function(e,t){this.state.clipSuccess||(this.clipboard.destroy(),this.handleClipboardJS())}},{key:"componentWillUnmount",value:function(){this.clipboard.destroy()}},{key:"render",value:function(){var e=this,t=this.props.item,a=t.title,i=t.namespace,n=t.key,s=t.created_at,l=t.updated_at,c=this.props,r=c.metafields,o="undefined"==c.metafieldsName;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)(j.a,{children:[Object(x.jsxs)(j.a.Item,{fill:!0,children:[Object(x.jsx)("span",{className:"Polaris-Heading",children:a}),Object(x.jsx)("span",{className:"ml10",children:!!s&&Object(x.jsxs)(N.a,{variation:"subdued",children:["create at: ",this.handleCalcDate(s)]})}),Object(x.jsx)("span",{className:"ml10",children:!!l&&Object(x.jsxs)(N.a,{variation:"subdued",children:["last update: ",this.handleCalcDate(l)]})})]}),Object(x.jsx)(j.a.Item,{children:Object(x.jsxs)("div",{className:"tr",children:[o?Object(x.jsx)(G.a,{content:"Liquid code unavailable",preferredPosition:"above",children:Object(x.jsx)(b.a,{id:"copy_".concat(this.index),icon:E.a,plain:!0,disabled:!0})}):Object(x.jsx)(b.a,{id:"copy_".concat(this.index),icon:E.a,plain:!0,disabled:!(i&&n)}),Object(x.jsx)("span",{className:"ml10",children:Object(x.jsx)(b.a,{icon:U.a,disabled:1==r.filter((function(e){return"create"==e.type})).length&&r.filter((function(e){return!e.isDeleted&&"edit"==e.type})).length<1,plain:!0,onClick:this.props.onClose})})]})})]}),this.state.clipSuccess&&Object(x.jsx)(p.a,{content:"Copied",onDismiss:function(){e.handleCloseToast()}})]})}}]),a}(o.a.Component),B=a(619),H=a(226),J=a(356),Y=function(){function e(){Object(n.a)(this,e),this.timer=null,this.delay=500}return Object(s.a)(e,[{key:"setTimer",value:function(e){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){e&&e()}),this.delay)}}]),e}(),Z=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y,i.state={value:i.props.data.value},i}return Object(s.a)(a,[{key:"handleChange",value:function(e){var t=this;this.setState({value:e},(function(){t.throttle.setTimer((function(){t.props.handleValue(e)}))}))}},{key:"componentDidUpdate",value:function(e,t){e.data.value!=this.props.data.value&&this.setState({value:this.props.data.value})}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state.value;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsx)(N.a,{variation:"subdued",children:"This field is restricted to String format only. HTML, URL, Email, Date, JSON String formats are not allowed."}),Object(x.jsxs)("div",{className:"mt5",children:[Object(x.jsx)(C.a,{multiline:2,error:t.valueInvalid.isInvalid,value:a,onChange:function(t){e.handleChange(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})}}]),a}(o.a.Component),Q=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y,i.state={value:i.props.data.value},i}return Object(s.a)(a,[{key:"handleChange",value:function(e){var t=this;e&&!/^\d+$/.test(e)||this.setState({value:e},(function(){t.throttle.setTimer((function(){t.props.handleValue(e)}))}))}},{key:"componentDidUpdate",value:function(e,t){e.data.value!=this.props.data.value&&this.setState({value:this.props.data.value})}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state.value;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsxs)("div",{className:"mt5",children:[Object(x.jsx)(C.a,{type:"number",error:t.valueInvalid.isInvalid,value:a,onChange:function(t){e.handleChange(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})}}]),a}(o.a.Component),K=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y;var s=i.props.data.value;return i.state={htmlString:s},i}return Object(s.a)(a,[{key:"handleChange",value:function(e){var t=this;this.setState({htmlString:e}),this.throttle.setTimer((function(){t.props.handleValue(e)}))}},{key:"render",value:function(){var e=this,t=this.state.htmlString,a=this.props.data;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(C.a,{error:a.valueInvalid.isInvalid,value:t,multiline:8,onChange:function(t){e.handleChange(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:a.valueInvalid.errorMessage})})]})}}]),a}(o.a.Component),q=a(52),W=a(306),$=a.n(W),X=(a(259),a(526)),ee=a.n(X);$.a.use(ee()({defaultColumns:3,defaultRows:3,withDropdown:!0,columnResizable:!0,exportAttrString:'border="0" style="border-collapse: collapse"'}));var te=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).textarea=o.a.createRef(),i.htmlString=i.props.data.value,i.throttle=new Y,i.apiUploadPath="".concat(window.appEnvironment.apiURL,"upload"),i.hooks={"remove-medias":function(e){i.handleRemoveMedias(e)},"open-braft-finder":function(){i.handleGetImage()}},i.media={items:[],uploadFn:function(e){i.handleUploadFn(e)},accepts:{image:"image/gif,image/jpeg,image/jpg,image/png,image/bmp,image/ico"}},i.state={htmlString:i.htmlString,editorState:$.a.createEditorState(i.htmlString)},i.init(),i}return Object(s.a)(a,[{key:"init",value:function(){this.timer=null,this.excludeControls=["emoji"],this.language="en"}},{key:"handleGetImage",value:function(){var e=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,t=this.state.htmlString.match(/<img.*?(?:>|\/>)/gi);if(t){var a=t.map((function(t,a){return{id:(new Date).getTime()+a,type:"IMAGE",url:t.match(e)[1]}}));this.braftFinder.removeAllItems(),this.braftFinder.addItems(a)}}},{key:"handleUploadFn",value:function(e){var t=new FormData;t.append("resource[]",e.file),t.append("dir","images"),window.axios.post(this.apiUploadPath,t,{onUploadProgress:function(t){e.progress(t.loaded/t.total*100)}}).then((function(t){var a=t.data.data;e.success({url:a.join()})})).catch((function(t){e.error({msg:"unable to upload."})}))}},{key:"handleRemoveMedias",value:function(e){e.map((function(e){return e.url})).join()}},{key:"handleConfirmSourceCode",value:function(){var e=this.textarea.current.value;this.setState({htmlString:e,editorState:$.a.createEditorState(e)})}},{key:"getExtendControls",value:function(e){var t=this,a=e.index,i=this.state.htmlString;return[{key:"modal".concat(a),type:"modal",text:Object(x.jsx)(q.a,{source:E.a}),modal:{id:"my-moda-".concat(a),width:940,height:800,title:"source code view",showConfirm:!1,onConfirm:function(){t.handleConfirmSourceCode()},children:Object(x.jsx)("div",{className:"p20",children:Object(x.jsx)("textarea",{disabled:!0,className:"source-code-input",style:{width:"100%",height:"620px"},ref:this.textarea,defaultValue:i})})}}]}},{key:"handleEditorChange",value:function(e){var t=this;this.setState({htmlString:e.toHTML(),editorState:$.a.createEditorState(e)},(function(){t.throttle.setTimer((function(){var a=e.toHTML();t.props.handleValue(a)}))}))}},{key:"componentDidUpdate",value:function(e,t){e.data.value!=this.props.data.value&&this.props.data.value==this.htmlString&&this.setState({htmlString:this.props.data.value,editorState:$.a.createEditorState(this.props.data.value)})}},{key:"componentDidMount",value:function(){this.braftFinder=this.editorInstance.getFinderInstance()}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state.editorState,i=this.getExtendControls(t);return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsxs)("div",{className:"braft-editor-body mt5",children:[Object(x.jsx)($.a,{className:"h400",ref:function(t){return e.editorInstance=t},excludeControls:this.excludeControls,language:this.language,extendControls:i,value:a,onChange:function(t){return e.handleEditorChange(t)},media:this.media,hooks:this.hooks}),Object(x.jsxs)("div",{className:"hiddenInput",children:[Object(x.jsx)(C.a,{labelHidden:!0,type:"hidden",value:t.value,error:t.valueInvalid.isInvalid}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})]})}}]),a}(o.a.Component),ae=a(39),ie=a(273),ne=a(615),se=a(622),le=a(606),ce=a(607),re=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).imageSize="20",i.filesMaxNum=10,i.files=i.props.data.value,i.apiPath="".concat(window.appEnvironment.apiURL,"upload"),i.validImageTypes=["image/gif","image/jpeg","image/jpg","image/png","image/bmp","image/x-icon","image/vnd.microsoft.icon"],i.validFileTypes=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptx","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","text/csv","text/plain","application/zip","application/x-zip-compressed","application/x-rar"],i.allowMultiple=i.props.allowMultiple||!1,i.isFile=i.props.isFile||!1,i.type=i.isFile?"file":"image",i.accept=i.props.isFile?i.validFileTypes:i.validImageTypes,i.state={active:!1,toastTitle:"Success",openFileDialog:!1,files:i.props.data.value?i.props.data.value.split(","):[],loading:!1},i}return Object(s.a)(a,[{key:"toggleActive",value:function(){this.setState({active:!this.state.active})}},{key:"toggleOpenFileDialog",value:function(){this.setState({openFileDialog:!this.state.openFileDialog})}},{key:"handleDropZoneDrop",value:function(e,t,a){var i=this;if(this.state.files.length+e.length>this.filesMaxNum)this.setState({toastTitle:"You can only upload ".concat(this.filesMaxNum," images in one metafield."),active:!0});else{var n=new FormData,s=[],l=[];if(e.length&&e.forEach((function(e){if(console.log(e.type,111),i.validImageTypes.includes(e.type)||i.validFileTypes.includes(e.type)||""==e.type){if(e.size/1024/1024>i.imageSize)return void l.push(e);n.append("resource[]",e),s.push(e)}else console.log("error")})),l.length>0){l.map((function(e){return e.name}));this.setState({active:!0,toastTitle:"Only less than ".concat(this.imageSize," MB allowed")})}n.append("dir","".concat(this.type,"s")),s.length?(this.setState({loading:!0}),window.axios.post(this.apiPath,n).then((function(e){var t=e.data.status;if(200==t){var a=e.data.data,n=i.state.files.join(),s=i.allowMultiple?[].concat(Object(P.a)(i.state.files),Object(P.a)(a)):a;i.setState({files:s,loading:!1,active:!0,toastTitle:"Upload Success"},(function(){i.props.handleValue(i.state.files.join()),i.allowMultiple||i.props.getDeleteData(n)}))}403001==t&&i.setState({loading:!1,active:!0,toastTitle:"Only less than ".concat(i.imageSize," MB allowed")}),403002==t&&i.setState({loading:!1,active:!0,toastTitle:"You are using more space than the current plan quota, please delete the data you do not need or upgrade the plan."})})).catch((function(e){i.setState({loading:!1,active:!0,toastTitle:"Upload Error"})}))):console.log("error1")}}},{key:"handleModalClose",value:function(){this.setState({modalOpen:!1})}},{key:"handleDelete",value:function(e,t,a){this.deleteIndex=a,this.refs.ConfirmModal.handleModalOpen(),e.stopPropagation()}},{key:"handleModalDelete",value:function(e,t){var a=this,i=this.state.files.map((function(e){return e})),n=i.splice(this.deleteIndex,1).join();this.props.getDeleteData(n),this.setState({files:i},(function(){t&&t(),a.props.handleValue(a.state.files.join())})),this.handleModalClose()}},{key:"_handleGetName",value:function(e){var t=e.split("/").pop().split("---");return t[t.length-1]}},{key:"componentDidUpdate",value:function(e,t){e.data.value!=this.props.data.value&&""!=this.props.data.value&&this.setState({files:this.props.data.value.split(",")})}},{key:"render",value:function(){var e=this,t=this.props.data,a=t.selectedName,i=t.selected,n=t.value,s=t.valueInvalid,l=this.state,c=l.active,r=l.toastTitle,o=l.openFileDialog,d=l.files,u=(l.modalOpen,l.loading),h=Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{children:[a," *"]}),"file"==i?Object(x.jsxs)(N.a,{variation:"subdued",children:["Supported format- ppt,pptx,xls,xlsx,doc,docx,pdf,csv,txt,zip,rar; image size limit- ",this.imageSize,"MB"]}):Object(x.jsxs)(x.Fragment,{children:[this.allowMultiple&&Object(x.jsx)("div",{children:Object(x.jsxs)(N.a,{variation:"subdued",children:["maximum number of images- ",this.filesMaxNum]})}),Object(x.jsxs)(N.a,{variation:"subdued",children:["Supported format- png, jpg, jpeg, bmp, ico or gif; image size limit- ",this.imageSize,"MB"]})]})]});return Object(x.jsxs)("div",{className:"spinner-rel-body",children:[u&&Object(x.jsx)(ae.a,{notFullScreen:!0}),Object(x.jsx)(w.a,{sectioned:!0,title:h,children:Object(x.jsx)(ne.a,{type:this.type,accept:this.accept,openFileDialog:o,onDrop:function(t,a,i){e.handleDropZoneDrop(t,a,i)},onFileDialogClose:function(){e.toggleOpenFileDialog()},allowMultiple:this.allowMultiple,children:Array.isArray(d)&&d.length>0?Object(x.jsx)("div",{className:"Polaris-DropZone-FileUpload box-align-left",children:Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{children:Object(x.jsx)("div",{className:this.isFile?"border-1 mr20":"upload-button border-1 mr20",children:Object(x.jsx)(ne.a.FileUpload,{})})}),d.map((function(t,a){return Object(x.jsx)("div",{children:e.isFile?Object(x.jsx)("div",{className:"upload-file",children:Object(x.jsxs)("div",{className:"upload-file-item",children:[Object(x.jsxs)("a",{download:!0,href:t,onClick:function(e){e.stopPropagation()},target:"_blank",children:[Object(x.jsx)("div",{className:"upload-file-icon",children:Object(x.jsx)(q.a,{source:le.a})}),Object(x.jsx)("div",{className:"upload-file-title",children:e._handleGetName(t)})]}),Object(x.jsx)("div",{className:"upload-file-button",children:Object(x.jsx)(b.a,{outline:!0,size:"slim",fullWidth:!0,icon:U.a,onClick:function(i){e.handleDelete(i,t,a)}})})]})}):Object(x.jsx)("div",{className:"upload-image",children:Object(x.jsx)(j.a.Item,{children:Object(x.jsxs)("div",{className:"upload-image-item",children:[Object(x.jsx)(se.a,{size:"large",alt:t.name,source:t||ce.a}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(b.a,{outline:!0,size:"slim",fullWidth:!0,icon:U.a,onClick:function(i){e.handleDelete(i,t,a)}})})]})})})},a)}))]})}):Object(x.jsxs)("div",{className:"Polaris-DropZone-FileUpload box-align-left",children:[" ",Object(x.jsx)("div",{className:this.isFile?"border-1":"upload-button border-1",children:Object(x.jsx)(ne.a.FileUpload,{})})]})})}),Object(x.jsxs)("div",{className:"hiddenInput",children:[Object(x.jsx)(C.a,{labelHidden:!0,type:"hidden",value:n,error:s.isInvalid}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:s.errorMessage})})]}),Object(x.jsx)(ie.a,{ref:"ConfirmModal",modalTitle:"Delete this image?",modalText:"Are you sure you want to delete this image?",onModalDelete:function(t,a){e.handleModalDelete(t,a)}}),c&&Object(x.jsx)(p.a,{content:r,onDismiss:function(){return e.toggleActive()}})]})}}]),a}(o.a.Component),oe=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y,i.state={value:i.props.data.value||""},i}return Object(s.a)(a,[{key:"handleValue",value:function(e){var t=this;this.setState({value:e}),this.throttle.setTimer((function(){t.props.handleValue(e)}))}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state.value;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsxs)("div",{className:"mt5",children:[Object(x.jsx)(C.a,{error:t.valueInvalid.isInvalid,placeholder:"Must be an absolute URL (including protocol), e.g. https://example.com/",value:a,onChange:function(t){e.handleValue(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})}}]),a}(o.a.Component),de=a(527),ue=a.n(de),he=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y,i.state={color:i.props.data.value?i.props.data.value:"#f00"},i}return Object(s.a)(a,[{key:"handleChange",value:function(e){var t=this;this.setState({color:e.color}),this.throttle.setTimer((function(){t.props.handleValue(e.color)}))}},{key:"componentDidUpdate",value:function(e,t){e.data.value!=this.props.data.value&&this.setState({color:this.props.data.value})}},{key:"componentDidMount",value:function(){var e=this.state.color;this.props.handleValue(e)}},{key:"render",value:function(){var e=this,t=this.props.data,a=t.selectedName,i=t.value,n=t.valueInvalid,s=this.state.color;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[a," *"]}),Object(x.jsxs)("div",{className:"mt5",children:[Object(x.jsx)(ue.a,{color:s,mode:"RGB",align:{points:["tl","tr"],offset:[10,0]},enableAlpha:!1,onChange:function(t){e.handleChange(t)},children:Object(x.jsx)("span",{className:"rc-color-picker-trigger size-30w"})}),Object(x.jsxs)("div",{className:"hiddenInput",children:[Object(x.jsx)(C.a,{labelHidden:!0,type:"hidden",value:i,error:n.isInvalid}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:n.errorMessage})})]})]})]})}}]),a}(o.a.Component),pe=a(584),ve=a.n(pe),me=a(588),je=a(244),fe=a.n(je),be=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],i.options=[{label:"DD/MM/YYYY",value:"1"},{label:"YYYY/MM/DD",value:"2"}],i.selectedDay=i.props.data.value?i.props.data.value.split(" ")[0]:"",i.throttle=new Y,i.selected=/[a-zA-Z]+/g.test(i.selectedDay)?"1":"2",i.inputDay=i._toStringSelectedDay(i.selected,i.handleGetDefaultDay()),i.state={inputDay:"",selected:"1",selectedDay:i.handleGetDefaultDay(),time:i.handleGetTime()},i}return Object(s.a)(a,[{key:"init",value:function(){var e=this;this.setState({inputDay:this.inputDay,selected:this.selected},(function(){e.props.data.value||e._handleValue()}))}},{key:"handleGetTime",value:function(){var e=this.props.data.value?this.props.data.value.split(" ")[1]:"00:00:00",t=e?e.split(":"):[];return t.length?fe()({h:t[0],m:t[1],s:t[2]}):""}},{key:"handleGetDefaultDay",value:function(){var e=new Date,t={year:e.getFullYear(),month:Number(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1),day:e.getDate()};if(this.selectedDay){var a=this.selectedDay.split("/");/[a-zA-Z]+/g.test(this.selectedDay)?(t.year=Number(a[2]),t.month=Number(window.publicTools.leadingDigit(1*this.months.indexOf(a[1])+1)),t.day=Number(a[0])):(t.year=Number(a[0]),t.month=Number(window.publicTools.leadingDigit(a[1])),t.day=Number(a[2]))}return t}},{key:"handleSelectChange",value:function(e){var t=this,a=this.state.selectedDay;this.setState({selected:e},(function(){t._formatSelectedDay(a)}))}},{key:"handleInput",value:function(e){var t=e.target.value;this.setState({inputDay:t})}},{key:"handleSetSelectedDay",value:function(e){this._formatSelectedDay(e)}},{key:"handleTime",value:function(e){var t=this;e&&e.format("HH:mm:ss"),this.setState({time:e},(function(){t._handleValue()}))}},{key:"handleClearTime",value:function(){var e=this;this.setState({time:void 0},(function(){e._handleValue()}))}},{key:"_handleValue",value:function(){var e=this,t=this.state,a=t.inputDay,i=t.time,n=i?"".concat(a," ").concat(i.format("HH:mm:ss")):"".concat(a);this.throttle.setTimer((function(){e.props.handleValue(n)}))}},{key:"_formatSelectedDay",value:function(e){var t=this;if(e){var a=this.state.selected,i=this._toStringSelectedDay(a,e);this.setState({selectedDay:e,inputDay:i},(function(){t._handleValue()}))}}},{key:"_toStringSelectedDay",value:function(e,t){return"1"==e?"".concat(window.publicTools.leadingDigit(t.day),"/").concat(this.months[t.month-1],"/").concat(t.year):"2"==e?"".concat(t.year,"/").concat(window.publicTools.leadingDigit(t.month),"/").concat(window.publicTools.leadingDigit(t.day)):""}},{key:"componentDidUpdate",value:function(e,t){var a=this.props.data,i=a.value,n=a.type;if(i&&e.data.value!=i&&"edit"==n){var s=null,l="";/[a-zA-Z]+/g.test(i)?(s=this.handleGetDefaultDay(),l=this._toStringSelectedDay("1",this.state.selectedDay)):(s=this.handleGetDefaultDay(),l=this._toStringSelectedDay("2",this.state.selectedDay));var c=i.split(" ")[0],r=this.handleGetTime();i!="".concat(l," ").concat(this.state.time?this.state.time.format("HH:mm:ss"):fe()())&&this.setState({inputDay:c,selectedDay:s,selected:"1",time:r})}}},{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state,i=a.inputDay,n=a.selected,s=a.selectedDay,l=a.time;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsxs)("div",{className:"mt5",children:[t.selectedLabel,Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{children:Object(x.jsx)(J.a,{options:this.options,onChange:function(t){e.handleSelectChange(t)},value:n})}),Object(x.jsx)(j.a.Item,{children:Object(x.jsx)(ve.a,{value:s,onChange:function(t){e.handleSetSelectedDay(t)},renderInput:function(t){var a=t.ref;return Object(x.jsxs)("div",{className:"Polaris-TextField",children:[Object(x.jsx)("input",{readOnly:!0,ref:a,placeholder:"Select a date",onChange:function(t,a){return e.handleInput(t,a)},value:i,className:"Polaris-TextField__Input"}),Object(x.jsx)("div",{className:"Polaris-TextField__Backdrop"})]})},shouldHighlightWeekends:!0})}),Object(x.jsx)(j.a.Item,{children:Object(x.jsx)(me.a,{allowEmpty:!1,value:l,onChange:function(t){return e.handleTime(t)}})})]}),Object(x.jsxs)("div",{className:"hiddenInput",children:[Object(x.jsx)(C.a,{labelHidden:!0,type:"hidden",value:i,error:t.valueInvalid.isInvalid}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})]})}}]),a}(o.a.Component),ge=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).throttle=new Y,i.state={value:i.props.data.value||""},i}return Object(s.a)(a,[{key:"handleValue",value:function(e){var t=this;this.setState({value:e}),this.throttle.setTimer((function(){t.props.handleValue(e)}))}},{key:"render",value:function(){var e=this,t=this.props.data,a=this.state.value;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{children:[t.selectedName," *"]}),Object(x.jsxs)("div",{className:"mt5",children:[Object(x.jsx)(C.a,{multiline:2,error:t.valueInvalid.isInvalid,value:a,onChange:function(t){return e.handleValue(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:t.valueInvalid.errorMessage})})]})]})}}]),a}(o.a.Component),Oe=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props.metafields,a=this.props.data,i=a.index;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(B.a,{children:Object(x.jsxs)(B.a.Group,{condensed:!0,children:[Object(x.jsxs)("div",{children:[Object(x.jsx)(C.a,{disabled:"edit"==a.type,error:a.namespaceInvalid.isInvalid,label:"Namespace *",value:a.namespace,onChange:function(t){e.props.handleNameSpace(t.trim())}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:a.namespaceInvalid.errorMessage})})]}),Object(x.jsxs)("div",{children:[Object(x.jsx)(C.a,{disabled:"edit"==a.type,error:a.keyInvalid.isInvalid,label:"Key *",value:a.key,onChange:function(t){e.props.handleKey(t.trim())}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:a.keyInvalid.errorMessage})})]}),Object(x.jsxs)("div",{className:"create-textarea",children:[Object(x.jsx)(C.a,{error:a.descriptionInvalid.isInvalid,label:"Description",placeholder:"Description",multiline:!0,ariaActiveDescendant:!0,value:a.description,onChange:function(t){e.props.handleDescription(t)}}),Object(x.jsx)("div",{className:"mt10",children:Object(x.jsx)(H.a,{message:a.descriptionInvalid.errorMessage})})]}),Object(x.jsx)(J.a,{label:"Type *",options:this.props.options,value:a.selected,onChange:function(t){e.props.handleSelectChange(t,e.props.options)}})]})}),Object(x.jsx)("div",{className:"pt10",children:Object(x.jsx)(B.a,{children:Object(x.jsxs)("div",{children:["string"==t[i].selected&&Object(x.jsx)(Z,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"integer"==t[i].selected&&Object(x.jsx)(Q,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"html"==t[i].selected&&Object(x.jsx)(K,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"rich_text"==t[i].selected&&Object(x.jsx)(te,{data:a,handleValue:function(t){e.props.handleValue(t)},getDeleteData:function(t){e.props.getDeleteData(t)}}),"image"==t[i].selected&&Object(x.jsx)(re,{data:a,handleValue:function(t){e.props.handleValue(t)},getDeleteData:function(t){e.props.getDeleteData(t)}}),"multiple_images"==t[i].selected&&Object(x.jsx)(re,{data:a,handleValue:function(t){e.props.handleValue(t)},getDeleteData:function(t){e.props.getDeleteData(t)},allowMultiple:!0}),"file"==t[i].selected&&Object(x.jsx)(re,{data:a,handleValue:function(t){e.props.handleValue(t)},getDeleteData:function(t){e.props.getDeleteData(t)},isFile:!0}),"url"==t[i].selected&&Object(x.jsx)(oe,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"color_picker"==t[i].selected&&Object(x.jsx)(he,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"date_picker"==t[i].selected&&Object(x.jsx)(be,{data:a,handleValue:function(t){e.props.handleValue(t)}}),"json_string"==t[i].selected&&Object(x.jsx)(ge,{data:a,handleValue:function(t){e.props.handleValue(t)}})]})})})]})}}]),a}(o.a.Component),xe=function(e){return!e||(e.length<3||e.length>20||null)},ye=function(e){return!e||(e.length<3||e.length>30||null)},De=function(e){return!!(e&&e.length>255)||null},Se=function(e){return!e||null},ke=function(e){return!!/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e)||null},Ie=a(55),we=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).id=window.publicTools.getQuery("id"),i.parentId=window.publicTools.getQuery("parentId"),i.ownerHandle=window.publicTools.getQuery("owner_handle"),i.options=[{label:"String",value:"string"},{label:"Integer",value:"integer"},{label:"Html",value:"html"},{label:"Rich Text",value:"rich_text"},{label:"Image",value:"image"},{label:"Multiple Images",value:"multiple_images"},{label:"File",value:"file"},{label:"URL",value:"url"},{label:"Color Picker",value:"color_picker"},{label:"Date Picker",value:"date_picker"},{label:"JSON String",value:"json_string"}],i.deleteUploads=[],i.metafieldsItem={id:"",type:"create",title:"Create metefield",selected:"string",selectedName:i.options.find((function(e){return"string"==e.value}))&&i.options.find((function(e){return"string"==e.value})).label,namespace:"",key:"",description:"",value:"",isDeleted:!1,created_at:"",updated_at:"",namespaceInvalid:{isInvalid:null,errorMessage:""},keyInvalid:{isInvalid:null,errorMessage:""},descriptionInvalid:{isInvalid:null,errorMessage:""},valueInvalid:{isInvalid:null,errorMessage:""}},i.state={metafields:[]},i}return Object(s.a)(a,[{key:"initMetafieldsData",value:function(e){if(!this.state.metafields.length){this.backMetafields=JSON.parse(JSON.stringify([])),this.setState({metafields:[this.metafieldsItem]}),this.props.onGetDelete(1)}}},{key:"handleCreate",value:function(){var e=this.state.metafields.map((function(e){return Object(i.a)({},e)}));return e.unshift(this.metafieldsItem),this.setState({metafields:e}),e.filter((function(e){return"create"==e.type})).length}},{key:"handleDelete",value:function(e,t,a){var n=this.state.metafields,s="cancel"!=a&&"enter"==a;if(!("enter"==a&&1==n.filter((function(e){return"create"==e.type})).length&&n.filter((function(e){return!e.isDeleted&&"edit"==e.type})).length<1)){var l=this.state.metafields.map((function(e,a){return Object(i.a)(Object(i.a)({},e),{},{isDeleted:t==a?s:e.isDeleted})}));if("enter"==a&&"create"==e.type&&l.splice(t,1),["image","multiple_images","file"].includes(e.selected)){var c=e.value.split(",");"enter"==a?this.deleteUploads=[].concat(Object(P.a)(this.deleteUploads),Object(P.a)(c)):"cancel"==a&&(this.deleteUploads=this.deleteUploads.filter((function(e){return!c.includes(e)})))}this.setState({metafields:l});var r=l.filter((function(e){return"create"==e.type})).length;this.props.onGetDelete(r)}}},{key:"handleNameSpace",value:function(e,t){var a=this.state.metafields.map((function(a,n){return Object(i.a)(Object(i.a)({},a),{},{namespace:t==n?e:a.namespace,namespaceInvalid:Object(i.a)(Object(i.a)({},a.namespaceInvalid),{},{isInvalid:t==n?xe(e):a.namespaceInvalid.isInvalid,errorMessage:t==n?xe(e)?"Enter 3-20 characters":"":a.namespaceInvalid.errorMessage})})}));this.setState({metafields:a}),this.props.onGetValidate(this._handleGetValidate(a))}},{key:"handleKey",value:function(e,t){var a=this.state.metafields.map((function(a,n){return Object(i.a)(Object(i.a)({},a),{},{key:t==n?e:a.key,keyInvalid:Object(i.a)(Object(i.a)({},a.keyInvalid),{},{isInvalid:t==n?ye(e):a.keyInvalid.isInvalid,errorMessage:t==n?ye(e)?"Enter 3-30 characters":"":a.keyInvalid.errorMessage})})}));this.setState({metafields:a}),this.props.onGetValidate(this._handleGetValidate(a))}},{key:"handleDescription",value:function(e,t){var a=this.state.metafields.map((function(a,n){return Object(i.a)(Object(i.a)({},a),{},{description:t==n?e:a.description,descriptionInvalid:Object(i.a)(Object(i.a)({},a.descriptionInvalid),{},{isInvalid:t==n?De(e):a.descriptionInvalid.isInvalid,errorMessage:t==n?De(e)?"Enter less 255 characters":"":a.descriptionInvalid.errorMessage})})}));this.setState({metafields:a}),this.props.onGetValidate(this._handleGetValidate(a))}},{key:"handleValue",value:function(e,t){var a=this.state.metafields.map((function(a,n){return Object(i.a)(Object(i.a)({},a),{},{valueInvalid:Object(i.a)(Object(i.a)({},a.valueInvalid),{},{isInvalid:t==n&&"url"==a.selected?!ke(e):t==n?Se(e):a.valueInvalid.isInvalid,errorMessage:t==n&&"url"==a.selected?ke(e)?"":"Enter the correct URL":t==n?Se(e)?"Is Required":"":a.valueInvalid.errorMessage}),value:t==n?e:a.value})}));this.setState({metafields:a}),this.props.onGetValidate(this._handleGetValidate(a))}},{key:"handleSelectChange",value:function(e,t,a){if("false"!=t.find((function(t){return t.value==e})).enable){var n=this.state.metafields.map((function(n,s){return Object(i.a)(Object(i.a)({},n),{},{value:a==s?"":n.value,selected:a==s?e:n.selected,selectedName:a==s?t.find((function(t){return t.value==e})).label:n.selectedName})}));this.setState({metafields:n})}else Ie.a.emit("openPlanModal",e)}},{key:"handleDiscard",value:function(e){"click"!=e?this.props.onDiscard():this.setState({metafields:this.backMetafields})}},{key:"handleValidate",value:function(){var e=this.state.metafields.map((function(e,t){return Object(i.a)(Object(i.a)({},e),{},{namespaceInvalid:Object(i.a)(Object(i.a)({},e.namespaceInvalid),{},{isInvalid:xe(e.namespace),errorMessage:xe(e.namespace)?"Enter 3-20 characters":""}),keyInvalid:Object(i.a)(Object(i.a)({},e.keyInvalid),{},{isInvalid:ye(e.key),errorMessage:ye(e.key)?"Enter 3-30 characters":""}),descriptionInvalid:Object(i.a)(Object(i.a)({},e.descriptionInvalid),{},{isInvalid:De(e.description),errorMessage:De(e.description)?"Enter less 255 characters":""}),valueInvalid:Object(i.a)(Object(i.a)({},e.valueInvalid),{},{isInvalid:"url"==e.selected&&!ke(e.value)||Se(e.value),errorMessage:"url"==e.selected?Se(e.value)?"Is Required":ke(e.value)?"":"Enter the correct URL":Se(e.value)?"Is Required":""})})}));return this.setState({metafields:e}),this._handleGetValidate(e)}},{key:"handleSave",value:function(e,t){var a=this.handleValidate(),i="".concat(window.appEnvironment.apiURL,"multiMetas");if(!a&&!e){var n=this._getSaveParams();window.axios.post(i,n).then((function(e){t&&t(e)}))}}},{key:"_getSaveParams",value:function(){var e={ownerResource:this.props.ownerResource,ownerId:this.id,new_metas:this._getMetafields("create"),deleted_metas:this._getDeleteMetafields(),edited_metas:this._getMetafields("edit"),deleted_uploads:this.deleteUploads.join()};return"undefined"!=this.parentId&&(e.ownerPid=this.parentId),e}},{key:"_getDeleteMetafields",value:function(){return this.state.metafields.filter((function(e){return e.isDeleted})).map((function(e){return e.id})).join()}},{key:"_getMetafields",value:function(e){var t=this,a=this.state.metafields.filter((function(t){return t.type==e&&!t.isDeleted})).filter((function(e){return"create"==e.type||("edit"==e.type?!JSON.stringify(t.backMetafields).includes(JSON.stringify(e)):void 0)})).map((function(a){var i={namespace:a.namespace,key:a.key,value:a.value,value_type:a.selected,description:a.description};return"create"==e&&(i.owner_handle=t.ownerHandle),i}));return a.length?JSON.stringify(a):""}},{key:"_handleGetValidate",value:function(e){return e.filter((function(e){return!e.isDeleted})).some((function(e){return e.namespaceInvalid.isInvalid||e.keyInvalid.isInvalid||e.descriptionInvalid.isInvalid||e.valueInvalid.isInvalid}))}},{key:"_getRepeatData",value:function(){return window.publicTools.getRepeatArr(this.state.metafields)}},{key:"_getDeleteData",value:function(e){return this.deleteUploads.push(e),this.deleteUploads}},{key:"componentDidUpdate",value:function(e,t){var a=this.props.metafields.length?JSON.stringify(this.props.metafields):"";a==(e.metafields.length?JSON.stringify(e.metafields):"")&&0!=a||this.initMetafieldsData();var i=this._filterCompareData(this.backMetafields),n=this._filterCompareData(this.state.metafields);this.state.metafields.length&&(i==n&&this.props.isDirty&&this.handleDiscard(),i==n||this.props.isDirty||this.props.onShowSaveBar())}},{key:"_filterCompareData",value:function(e){if(e)return JSON.stringify(e.map((function(e){return delete e.index,Object(i.a)({},e)})))}},{key:"componentDidMount",value:function(){this.initMetafieldsData()}},{key:"render",value:function(){var e=this,t=this.state.metafields,a=this.props.metafieldsName;return!!t.length&&Object(x.jsx)("div",{className:this.props.className,children:t.map((function(i,n){return i.index=n,Object(x.jsx)("div",{className:"mt20",children:i.isDeleted&&"edit"==i.type?Object(x.jsx)(D.a,{status:"warning",icon:U.a,children:Object(x.jsxs)(j.a,{children:[Object(x.jsx)(j.a.Item,{fill:!0,children:Object(x.jsxs)("div",{className:"lh20",children:["Metafield ",i.key," by"," ",i.namespace," global be removed"]})}),Object(x.jsx)(j.a.Item,{children:Object(x.jsx)(b.a,{size:"slim",outline:!0,onClick:function(){e.handleDelete(i,n,"cancel")},children:"Cancel"})})]})}):Object(x.jsx)(w.a,{title:Object(x.jsx)(L,{metafields:t,item:i,metafieldsName:a,onClose:function(){e.handleDelete(i,n,"enter")}}),sectioned:!0,children:Object(x.jsx)(Oe,{ref:"MetafieldsItem",metafields:t,options:e.options,data:i,getDeleteData:function(t){e._getDeleteData(t)},handleNameSpace:function(t){e.handleNameSpace(t,n)},handleKey:function(t){e.handleKey(t,n)},handleDescription:function(t){e.handleDescription(t,n)},handleSelectChange:function(t,a){e.handleSelectChange(t,a,n)},handleValue:function(t){e.handleValue(t,n)}})})},n)}))})}}]),a}(o.a.Component),Ce=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).ownerResource=i.props.match.params.ownerResource,i.metafieldsName=window.publicTools.getQuery("metafieldsName"),i.id=window.publicTools.getQuery("id"),i.parentId=window.publicTools.getQuery("parentId"),i.state={active:!1,toastContent:"",insertRepeats:[],loading:!0,valid:!1,isDirty:!1,isRepeat:!1,repeatData:[],metafields:[],metafieldsLength:0,link:{},currentPage:1,params:{namespace:"",key:"",limit:10,pageInfo:""}},i}return Object(s.a)(a,[{key:"getItems",value:function(){this.setState({metafields:[],loading:!1})}},{key:"handleCreate",value:function(){var e=this.refs.EditorComponent.handleCreate();this.setState({metafieldsLength:e})}},{key:"handleGetDelete",value:function(e){this.setState({metafieldsLength:e})}},{key:"handleShowSaveBar",value:function(){this.setState({isDirty:!0})}},{key:"handleSave",value:function(){var e=this,t=this.refs.EditorComponent.handleValidate(),a=this.refs.EditorComponent._getRepeatData(),i=a.some((function(e){return e.data.length>1}));this.setState({valid:t,isRepeat:i,repeatData:a,loading:!t&&!i}),this.refs.EditorComponent.handleSave(i,(function(t){if(200==t.data.status){var a=t.data.data,i=a.inserted.split("/").join(" of "),n=a.updated.split("/").join(" of "),s=a.deleted.split("/").join(" of "),l="Created ".concat(i,", edited ").concat(n,", deleted ").concat(s);a.insert_repeats.length&&e.setState({insertRepeats:a.insert_repeats}),e.setState({active:!0,toastContent:l}),e.getItems()}}))}},{key:"handleClearInsertRepeats",value:function(){this.setState({insertRepeats:[]})}},{key:"handleDiscard",value:function(e){if("click"==e)return this.refs.EditorComponent.handleDiscard(e),void this.setState({isDirty:!1,valid:!1,isRepeat:!1,metafieldsLength:0});this.setState({isDirty:!1,valid:!1,isRepeat:!1,repeatData:[],metafieldsLength:0})}},{key:"handleSearch",value:function(e,t){var a=this,n=Object(i.a)(Object(i.a)({},this.state.params),{},{namespace:e,key:t,pageInfo:""});this.setState({params:n,loading:!0,currentPage:1},(function(){a.getItems()}))}},{key:"handleGetValidate",value:function(e){this.setState({valid:e})}},{key:"handlePagination",value:function(e){var t=this,a=this.state,n=a.params,s=a.link,l="previous"==e?s.previous:"next"==e?s.next:"",c=0;"previous"==e?c=this.state.currentPage>1?this.state.currentPage-1:1:"next"==e&&(c=this.state.currentPage+1),this.setState({params:Object(i.a)(Object(i.a)({},n),{},{pageInfo:l}),loading:!0,currentPage:c},(function(){t.getItems()}))}},{key:"toggleActive",value:function(){this.setState({active:!this.state.active})}},{key:"componentDidMount",value:function(){this.getItems()}},{key:"render",value:function(){var e=this,t=this.state,a=t.active,i=t.toastContent,n=t.insertRepeats,s=t.loading,l=t.isDirty,c=t.valid,r=t.isRepeat,o=t.repeatData,v=t.metafields,m=t.params,j=t.metafieldsLength,f=t.currentPage,b=t.link;return Object(x.jsx)("div",{className:"wrapper",children:Object(x.jsx)("div",{className:"container editor-body",children:Object(x.jsxs)(d.a,{children:[l&&Object(x.jsx)(u.a,{alignContentFlush:!0,message:"Unsaved changes",saveAction:{onAction:function(){e.handleSave()}},discardAction:{onAction:function(){e.handleDiscard("click")}}}),Object(x.jsx)(y,{metafieldsLength:j,ownerResource:this.ownerResource,handleCreate:function(){return e.handleCreate()}}),Object(x.jsx)(k,{valid:c,isRepeat:r,insertRepeats:n,repeatData:o,onClearInsertRepeats:function(){e.handleClearInsertRepeats()}}),Object(x.jsx)(R,{ref:"EditorTopSearchBar",className:"mt20",currentPage:f,params:m,link:b,metafields:v,onSearch:function(t,a){e.handleSearch(t,a)},onPagination:function(t){e.handlePagination(t)}}),s?Object(x.jsx)(ae.a,{}):Object(x.jsx)(we,{className:"mt20",metafieldsName:this.metafieldsName,ownerResource:this.ownerResource,params:m,metafields:v,isDirty:l,ref:"EditorComponent",onShowSaveBar:function(){e.handleShowSaveBar()},onDiscard:function(){e.handleDiscard()},onGetValidate:function(t){e.handleGetValidate(t)},onGetDelete:function(t){return e.handleGetDelete(t)}}),!!v.length&&Object(x.jsx)("div",{className:"section-list_footer tc mt20",children:Object(x.jsx)(h.a,{hasPrevious:!!b.previous,onPrevious:function(){e.handlePagination("previous")},hasNext:!!b.next,onNext:function(){e.handlePagination("next")}})}),a&&Object(x.jsx)(p.a,{content:i,onDismiss:function(){return e.toggleActive()}})]})})})}}]),a}(o.a.Component);t.default=Ce}}]);
//# sourceMappingURL=14.a035f4ec.chunk.js.map